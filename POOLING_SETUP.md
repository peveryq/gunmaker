# Настройка пулинга для пуль и гильз

## Что было сделано

Реализован пулинг для пуль и гильз, чтобы избежать частых `Instantiate()`/`Destroy()` вызовов, которые критичны для производительности WebGL.

## Настройка на сцене

### 1. BulletPool

1. Создайте пустой GameObject на сцене (например, "BulletPool")
2. Добавьте компонент `BulletPool`
3. Назначьте префаб пули в поле **Bullet Prefab**
4. Настройте параметры:
   - **Initial Pool Size**: 30 (начальный размер пула)
   - **Max Pool Size**: 100 (максимальный размер, если пул исчерпан)

### 2. CasingPool

1. Создайте пустой GameObject на сцене (например, "CasingPool")
2. Добавьте компонент `CasingPool`
3. Назначьте префаб гильзы в поле **Casing Prefab**
4. Настройте параметры:
   - **Initial Pool Size**: 50 (больше чем пуль, т.к. гильзы живут дольше)
   - **Max Pool Size**: 200 (максимальный размер)

## Как это работает

### Пули (BulletPool)

- При выстреле: `BulletPool.Instance.GetBullet()` получает пулю из пула
- При попадании/истечении времени: `BulletPool.Instance.ReturnBullet()` возвращает в пул
- Если пул пуст: создается новая пуля (до maxPoolSize)
- Если пул переполнен: переиспользуется самая старая активная пуля

### Гильзы (CasingPool)

- При выстреле: `CasingPool.Instance.GetCasing()` получает гильзу из пула
- При истечении lifetime: `CasingPool.Instance.ReturnCasing()` возвращает в пул
- Автоматический сброс состояния через `BulletCasing.Reset()`

## Преимущества

**Без пулинга:**
- При скорострельности 10 выстрелов/сек = 10 Instantiate + 10 Destroy в секунду
- Высокая нагрузка на GC (сборщик мусора)
- Просадки FPS на WebGL

**С пулингом:**
- Первые 30 пуль создаются один раз при старте
- Дальше только переиспользование объектов
- Минимальная нагрузка на GC
- Стабильный FPS

## Производительность

### Пули:
- **Без пулинга**: ~10 Instantiate/сек при активной стрельбе
- **С пулингом**: 0 Instantiate после инициализации, только переиспользование

### Гильзы:
- **Без пулинга**: ~10 Instantiate/сек + ~10 Destroy/сек (через 5 сек)
- **С пулингом**: 0 Instantiate/Destroy после инициализации

**Экономия**: ~95% снижение вызовов Instantiate/Destroy для пуль и гильз.

## Важно

- Пулы автоматически создают объекты при первом использовании, если они не были предзагружены
- Если пул исчерпан, система переиспользует старые объекты (не создает новые)
- Все пулы работают в режиме "graceful degradation" - если пула нет, используется обычный Instantiate

## Интеграция

Код уже интегрирован в:
- ✅ `WeaponController.Shoot()` - использует BulletPool
- ✅ `WeaponController.EjectCasing()` - использует CasingPool
- ✅ `Bullet.OnCollisionEnter()` - возвращает в BulletPool
- ✅ `BulletCasing.Update()` - возвращает в CasingPool

**Никаких дополнительных изменений не требуется!**

