# Инструкция по настройке системы сохранений

## Обзор

Система сохранений полностью автоматизирована и интегрирована с YG2 Storage модулем. Большинство компонентов создаются автоматически, но необходимо настроить UI элементы для отображения автосохранения.

## Что уже работает автоматически

- **SaveSystemManager** - создается автоматически при старте игры (не требует настройки на сцене)
- **MoneySystem** - должен существовать на сцене (уже настроен)
- **WeaponSlotManager** - создается автоматически при старте игры
- **LocationManager** - должен существовать на сцене (уже настроен)
- Сохранение данных происходит автоматически через YG2 Storage модуль

## Что нужно настроить на сцене

### 1. Настройка UI для автосохранения в GameplayHUD

Необходимо добавить UI элементы для отображения индикатора автосохранения в `GameplayHUD`:

1. Откройте объект `GameplayHUD` на сцене
2. Создайте новый GameObject под `GameplayHUD` для автосохранения (например, `AutoSaveIndicator`)
3. Настройте структуру:
   ```
   GameplayHUD
   └── AutoSaveIndicator (GameObject)
       ├── Icon (Image) - иконка для вращения
       └── Text (TextMeshProUGUI) - текст "autosave"
   ```

4. В компоненте `GameplayHUD` найдите секцию **Auto-Save Indicator**:
   - **Autosave Root** - перетащите GameObject `AutoSaveIndicator`
   - **Autosave Icon** - перетащите компонент Image с иконкой
   - **Autosave Text** - перетащите компонент TextMeshProUGUI с текстом
   - **Autosave Icon Rotation Speed** - скорость вращения иконки (по умолчанию 180°/сек)
   - **Autosave Display Duration** - длительность показа индикатора (по умолчанию 1.5 сек)
   - **Autosave Text String** - текст для отображения (по умолчанию "autosave")

5. **Рекомендации по UI:**
   - Разместите индикатор автосохранения в удобном месте на экране (например, в верхнем правом углу)
   - Используйте простую иконку диска/сохранения для `Icon`
   - Установите альфа-канал для фона/текста если нужно (опционально)
   - Иконка должна быть квадратной или круглой для лучшего эффекта вращения

### 2. Проверка компонентов на сцене

Убедитесь, что на сцене присутствуют следующие компоненты (они должны быть уже настроены):

- **MoneySystem** - должен существовать на сцене с настройкой начальных денег
- **LocationManager** - должен существовать на сцене с настройкой локаций
- **Workbench** - должен существовать на сцене (для сохранения оружия на верстаке)
- **GameplayHUD** - должен существовать на сцене с настройкой UI элементов

## Как работает система сохранений

### Автосохранение

1. **Таймер автосохранения** - каждые 20 секунд (только в мастерской)
2. **Автосохранение при возвращении из стрельбища** - срабатывает в момент закрытия окна награды (`ResultsScreenUI`)
3. **Таймер сбрасывается** при переходе в стрельбище и при возвращении в мастерскую

### Что сохраняется

- **Деньги игрока** (`MoneySystem.CurrentMoney`)
- **Оружие в слотах** (`WeaponSlotManager` - все оружие со всеми деталями)
- **Оружие на верстаке** (`Workbench.MountedWeapon` - если есть)

### Формат сохранений

Данные сохраняются через YG2 Storage модуль:
- **Локальное сохранение** - использует PlayerPrefs (WebGL) или локальный файл (Editor)
- **Облачное сохранение** - синхронизируется с облаком Yandex Games (если включено в настройках YG2)

## Тестирование

### Очистка сохранений для тестирования

Используйте инструмент Unity Editor:
- Меню: **Tools → Gunmaker → Clear PlayerPrefs**
- Подтвердите очистку в диалоговом окне
- Перезапустите игру для применения изменений

### Проверка работы автосохранения

1. Запустите игру в мастерской
2. Измените что-то (добавьте деньги, создайте оружие, установите детали)
3. Подождите 20 секунд - должен появиться индикатор автосохранения с вращающейся иконкой
4. Перейдите в стрельбище - автосохранение должно остановиться
5. Вернитесь из стрельбища через окно награды - должно произойти автосохранение с индикатором
6. Перезапустите игру - данные должны загрузиться автоматически

## Дополнительные заметки

- Система сохранений автоматически подписывается на события YG2 (`onGetSDKData`) для загрузки данных
- Все автосохранения объединены в централизованную систему для предотвращения спама
- UI индикатор автосохранения использует DOTween для плавного вращения иконки
- Автосохранение работает только в мастерской (`LocationType.Workshop`), на стрельбище (`LocationType.TestingRange`) отключено

## Решение проблем

### Автосохранение не работает

1. Проверьте, что `LocationManager` существует на сцене
2. Убедитесь, что вы находитесь в мастерской (не на стрельбище)
3. Проверьте логи Unity на наличие ошибок инициализации YG2 SDK

### UI индикатор не показывается

1. Проверьте, что все ссылки в `GameplayHUD` настроены правильно
2. Убедитесь, что `GameplayHUD.Instance` существует и доступен
3. Проверьте, что `autosaveRoot` активен в иерархии

### Данные не загружаются

1. Проверьте, что YG2 SDK инициализирован (должно быть сообщение в логах)
2. Убедитесь, что модуль Storage установлен в YG2
3. Проверьте настройки сохранений в YG2 (PluginYourGames → InfoYG → Storage)

