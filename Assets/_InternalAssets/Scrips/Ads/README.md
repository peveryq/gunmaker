# Ad System Integration

Система управления рекламой для интеграции с YG2 SDK.

## Компоненты

### AdManager
Главный менеджер рекламы. Управляет показом межстраничной рекламы и рекламы за вознаграждение.

**Основные функции:**
- Автоматический показ рекламы каждые N секунд (настраивается)
- Показ рекламы только в мастерской (Workshop)
- Сброс таймера при возврате в мастерскую после стрельбища
- Интеграция с LocationManager для контроля локаций
- Поддержка кастомного таймера или использование YG2 таймера

**Настройка:**
- `AdSettings` ScriptableObject (опционально) - настройки рекламы
- `adIntervalSeconds` - интервал между рекламами в секундах (по умолчанию 30)
- `showAdsOnlyInWorkshop` - показывать рекламу только в мастерской
- `AdTimerWarningUI` - UI для предупреждения с таймером

### AdTimerWarningUI
Полноэкранное окно с обратным отсчетом (3-2-1) перед показом рекламы.

**Особенности:**
- Автоматическая пауза игры (Time.timeScale = 0, AudioListener.pause = true)
- Анимация текста при смене цифр
- Звуковые эффекты для каждого шага отсчета
- Автоматическое возобновление игры после закрытия рекламы

**Настройка:**
- `rootPanel` - корневой GameObject панели
- `countdownText` - TextMeshProUGUI для отображения цифр
- `countdownDuration` - длительность отсчета в секундах (по умолчанию 3)
- `countdownSound` - звук для каждого шага
- `finalCountdownSound` - звук для финального шага


## Интеграция

### 1. Создание AdManager
1. Создайте GameObject на сцене
2. Добавьте компонент `AdManager`
3. Настройте параметры в инспекторе

### 2. Создание AdTimerWarningUI
1. Создайте Canvas для полноэкранного UI
2. Создайте панель с затемнением фона
3. Добавьте TextMeshProUGUI для отображения цифр
4. Добавьте компонент `AdTimerWarningUI` на панель
5. Назначьте ссылки в инспекторе
6. Назначьте `AdTimerWarningUI` в `AdManager`

### 3. Интеграция в ResultsScreenUI
Реклама уже интегрирована в `ResultsScreenUI`:
- `nextButton` - показывает межстраничную рекламу перед возвратом в мастерскую (без предупреждения)
- `getX2Button` - показывает рекламу за вознаграждение, удваивает заработок только при успешном просмотре

## Использование

### Показать межстраничную рекламу немедленно
```csharp
if (AdManager.Instance != null)
{
    AdManager.Instance.ShowInterstitialAdImmediate();
}
```

### Показать рекламу за вознаграждение
```csharp
if (AdManager.Instance != null)
{
    AdManager.Instance.ShowRewardedAd("RewardID", () => {
        // Выдать награду (callback вызывается только при успешном просмотре)
        Debug.Log("Reward given!");
    });
}
```

### Настройка интервала рекламы
Интервал настраивается в настройках YG2 плагина (PluginYourGames → Interstitial Adv → Inter Adv Interval). По умолчанию 60 секунд. В редакторе можно настроить отдельный интервал в General Simulation → Adv Interval Simulation.

## Важные замечания

1. **Пауза игры**: YG2 автоматически управляет паузой через `YG2.PauseGame()`. AdTimerWarningUI также паузит игру для показа предупреждения.

2. **Таймер**: Используется встроенный таймер YG2 (`YG2.isTimerAdvCompleted`). Интервал настраивается в настройках YG2 плагина.

3. **Сброс таймера**: Таймер автоматически сбрасывается при возврате в мастерскую после стрельбища.

4. **Локации**: Реклама показывается только в мастерской. Таймер останавливается при переходе на стрельбище.

5. **События YG2**: AdManager автоматически подписывается на события YG2 для управления состоянием рекламы.

6. **Блокировка таймера**: Реклама не показывается, пока открыты полноэкранные UI окна в мастерской. Следующие системы автоматически блокируют таймер:
   - `ShopUI` - при открытии/закрытии магазина
   - `WeaponLockerUI` - при открытии/закрытии оружейного шкафа
   - `WeaponSlotSelectionUI` - при открытии/закрытии выбора слота
   - `SettingsUI` - при открытии/закрытии настроек
   - `LocationSelectionUI` - при открытии/закрытии выбора локации
   
   Система использует счетчик блокировок, поэтому несколько UI могут быть открыты одновременно без конфликтов.

## Тестирование

В редакторе Unity YG2 SDK может быть недоступен. Система автоматически использует кастомный таймер в этом случае.

Для тестирования:
1. Установите `useCustomTimer = true` в настройках
2. Установите короткий интервал (например, 5 секунд)
3. Запустите игру в мастерской
4. Дождитесь показа рекламы

## Требования

- YG2 SDK с модулями InterstitialAdv и RewardedAdv
- LocationManager для контроля локаций
- AudioManager (опционально) для звуков предупреждения

