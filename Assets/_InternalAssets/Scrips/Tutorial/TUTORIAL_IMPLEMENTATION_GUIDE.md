# Гайд по имплементации системы туториала

## Обзор системы

Система туториала состоит из 12 последовательных квестов, которые обучают игрока основным механикам игры. Система автоматически запускается при первом запуске игры (когда нет сохранений) и сохраняет прогресс через систему автосохранений.

### Компоненты системы:

1. **TutorialManager** - главный менеджер, управляет всеми квестами
2. **TutorialQuestUI** - UI компонент для отображения текста квестов
3. **TutorialExclamationMark** - компонент для 3D восклицательных знаков
4. **TutorialQuest** - enum с типами квестов

---

## Шаг 1: Создание префаба восклицательного знака

### 1.1 Создание 3D модели восклицательного знака

1. В Unity создайте новый GameObject (3D Object > Cube или используйте готовую модель)
2. Назовите его `TutorialExclamationMark`
3. Настройте размер и форму (рекомендуется: масштаб примерно 0.3-0.5)
4. Добавьте материал с ярким цветом (например, желтый или оранжевый)
5. Расположите модель так, чтобы она была видна сверху

### 1.2 Добавление компонентов

1. Добавьте компонент `TutorialExclamationMark` на GameObject
2. Настройте параметры в Inspector:
   - **Animation Distance**: 0.3 (расстояние движения вверх-вниз)
   - **Animation Duration**: 1.0 (длительность одного цикла)
   - **Animation Ease**: InOutSine (тип анимации)

### 1.3 Создание префаба

1. Перетащите GameObject в папку `Assets/_InternalAssets/Prefabs/Tutorial/` (создайте папку, если её нет)
2. Назовите префаб `TutorialExclamationMark`
3. Удалите GameObject из сцены (префаб уже создан)

---

## Шаг 2: Настройка UI для квестов

### 2.1 Добавление UI элементов на GameplayHUD

1. Откройте сцену с GameplayHUD
2. Найдите Canvas с GameplayHUD
3. Создайте новый GameObject внутри Canvas, назовите его `TutorialQuestPanel`
4. Добавьте компонент `TutorialQuestUI` на этот GameObject

### 2.2 Настройка UI элементов

1. Создайте структуру UI:
   ```
   TutorialQuestPanel
   ├── Background (Image)
   ├── QuestIcon (Image)
   └── QuestText (TextMeshProUGUI)
   ```

2. Настройте компонент `TutorialQuestUI`:
   - **Root Panel**: перетащите `TutorialQuestPanel`
   - **Quest Text**: перетащите `QuestText` (TextMeshProUGUI)
   - **Quest Icon**: перетащите `QuestIcon` (Image) - опционально
   - **Background Image**: перетащите `Background` (Image) - опционально

3. Настройте параметры анимации:
   - **Complete Animation Duration**: 0.5
   - **Switch Animation Duration**: 0.3
   - **Normal Text Color**: белый (255, 255, 255, 255)
   - **Complete Text Color**: зеленый (0, 255, 0, 255)
   - **Bubble Scale**: 1.2

### 2.3 Настройка визуального стиля

1. **Background**:
   - Добавьте Image компонент
   - Настройте цвет (например, полупрозрачный черный)
   - Настройте размер (ширина ~600, высота ~80)
   - Расположите в верхней части экрана (например, Y = 400)

2. **Quest Text**:
   - Добавьте TextMeshProUGUI
   - Настройте шрифт, размер (например, 24-28)
   - Выровняйте по центру
   - Цвет: белый

3. **Quest Icon** (опционально):
   - Добавьте Image
   - Назначьте спрайт иконки квеста
   - Расположите слева от текста

### 2.4 Привязка к GameplayHUD

1. Откройте GameplayHUD в Inspector
2. Найдите поле **Tutorial Quest UI**
3. Перетащите GameObject с компонентом `TutorialQuestUI`

---

## Шаг 3: Создание и настройка TutorialManager

### 3.1 Создание GameObject

1. В сцене создайте пустой GameObject
2. Назовите его `TutorialManager`
3. Добавьте компонент `TutorialManager`

### 3.2 Настройка локаций квестов

**Важно**: Локации можно назначить вручную или оставить пустыми - система автоматически найдет их.

#### Ручная настройка (рекомендуется):

1. **Workbench Location** (для квестов 1, 4, 6, 9, 10):
   - Найдите GameObject с компонентом `Workbench` в сцене
   - Перетащите его Transform в поле **Workbench Location**

2. **Shop Computer Location** (для квестов 2, 7):
   - Найдите GameObject с компонентом `ShopComputer`
   - Перетащите его Transform в поле **Shop Computer Location**

3. **Part Spawn Location** (для квестов 3, 8):
   - Найдите `PartSpawner` в сцене
   - Перетащите его `spawnPoint` Transform в поле **Part Spawn Location**
   - Или оставьте пустым - система найдет автоматически

4. **Blowtorch Location** (для квеста 5):
   - Найдите GameObject с компонентом `Blowtorch`
   - Перетащите его Transform в поле **Blowtorch Location**

5. **Shooting Targets Location** (для квеста 11):
   - Найдите объект, указывающий на мишени (окно тира или триггерная зона)
   - Создайте пустой GameObject в нужном месте
   - Перетащите его Transform в поле **Shooting Targets Location**

6. **Location Door Location** (для квеста 12):
   - Найдите GameObject с компонентом `LocationDoor`
   - Перетащите его Transform в поле **Location Door Location**

### 3.3 Настройка префаба восклицательного знака

1. В поле **Exclamation Mark Prefab** перетащите префаб `TutorialExclamationMark`, созданный на шаге 1

### 3.4 Настройка аудио клипов

1. Подготовьте 24 аудио файла:
   - 12 квестов × 2 языка (en + ru) = 24 файла
   - Формат: `.wav`, `.mp3` или `.ogg`

2. Настройте массив **Quest Audio Clips** (размер 24):
   - [0] = Квест 1 (CreateGun) - английский
   - [1] = Квест 1 (CreateGun) - русский
   - [2] = Квест 2 (BuyBarrel) - английский
   - [3] = Квест 2 (BuyBarrel) - русский
   - [4] = Квест 3 (TakeBarrel) - английский
   - [5] = Квест 3 (TakeBarrel) - русский
   - [6] = Квест 4 (AttachBarrel) - английский
   - [7] = Квест 4 (AttachBarrel) - русский
   - [8] = Квест 5 (TakeBlowtorch) - английский
   - [9] = Квест 5 (TakeBlowtorch) - русский
   - [10] = Квест 6 (WeldBarrel) - английский
   - [11] = Квест 6 (WeldBarrel) - русский
   - [12] = Квест 7 (BuyMag) - английский
   - [13] = Квест 7 (BuyMag) - русский
   - [14] = Квест 8 (TakeMag) - английский
   - [15] = Квест 8 (TakeMag) - русский
   - [16] = Квест 9 (AttachMag) - английский
   - [17] = Квест 9 (AttachMag) - русский
   - [18] = Квест 10 (TakeGun) - английский
   - [19] = Квест 10 (TakeGun) - русский
   - [20] = Квест 11 (ShootTargets) - английский
   - [21] = Квест 11 (ShootTargets) - русский
   - [22] = Квест 12 (EnterRange) - английский
   - [23] = Квест 12 (EnterRange) - русский

3. Перетащите аудио файлы в соответствующие слоты массива

### 3.5 Привязка TutorialQuestUI

1. В поле **Quest UI** перетащите GameObject с компонентом `TutorialQuestUI` (созданный на шаге 2)

---

## Шаг 4: Проверка интеграций

### 4.1 Проверка сохранений

Система автоматически интегрирована с `SaveSystemManager`. Проверьте:
- `GameSaveData.cs` содержит поле `tutorialQuestIndex`
- При сохранении прогресс туториала сохраняется автоматически

### 4.2 Проверка локализации

Проверьте, что в `LocalizationManager.cs` добавлены все тексты квестов:
- `tutorial.quest.1` до `tutorial.quest.12`
- Для обоих языков (ru и en)

### 4.3 Проверка блокировки Workbench

Проверьте, что в `Workbench.cs` метод `UnmountWeapon()` проверяет:
```csharp
if (TutorialManager.Instance != null && TutorialManager.Instance.IsQuestBlockingTakeWeapon())
{
    return; // Блокировка до квеста 10
}
```

### 4.4 Проверка уведомлений о покупках

Проверьте, что в `PurchaseConfirmationUI.cs` после покупки вызывается:
```csharp
if (TutorialManager.Instance != null)
{
    TutorialManager.Instance.NotifyPartPurchased(currentPartType);
}
```

---

## Шаг 5: Тестирование

### 5.1 Тестирование первого запуска

1. Удалите сохранения игры (или запустите с пустыми сохранениями)
2. Запустите игру
3. Проверьте:
   - Туториал должен автоматически запуститься
   - Должен появиться первый квест: "Create a new gun at the workbench"
   - Над верстаком должен появиться восклицательный знак
   - Должна проиграться аудио озвучка на нужном языке

### 5.2 Тестирование прогресса квестов

Протестируйте каждый квест по порядку:

1. **Квест 1 - CreateGun**: Создайте оружие на верстаке
   - Квест должен завершиться
   - Текст должен стать зеленым и "бабблиться"
   - Должен появиться следующий квест

2. **Квест 2 - BuyBarrel**: Купите ствол в магазине
   - После покупки квест должен завершиться

3. **Квест 3 - TakeBarrel**: Поднимите ствол
   - После поднятия квест должен завершиться

4. И так далее для всех 12 квестов...

### 5.3 Тестирование сохранения прогресса

1. Пройдите несколько квестов
2. Сохраните игру (или дождитесь автосохранения)
3. Перезапустите игру
4. Проверьте:
   - Туториал должен продолжиться с того квеста, на котором остановились
   - Прогресс должен быть сохранен

### 5.4 Тестирование блокировки

1. Дойдите до квеста 9 (AttachMag)
2. Попробуйте взять оружие с верстака
3. Проверьте:
   - Оружие не должно браться (блокировка до квеста 10)
4. Завершите квест 9 и начните квест 10
5. Попробуйте взять оружие снова
6. Проверьте:
   - Оружие должно браться нормально

### 5.5 Тестирование полноэкранных окон

1. Во время туториала откройте магазин (полноэкранное окно)
2. Завершите квест (например, купите ствол)
3. Проверьте:
   - Анимация завершения квеста не должна проигрываться (пока открыт магазин)
   - После закрытия магазина квест должен обновиться

### 5.6 Тестирование завершения туториала

1. Пройдите все 12 квестов
2. Проверьте:
   - После последнего квеста туториал должен завершиться
   - UI квестов должен скрыться
   - Все восклицательные знаки должны исчезнуть
   - В сохранениях `tutorialQuestIndex` должен быть -1

---

## Шаг 6: Настройка позиций восклицательных знаков

### 6.1 Настройка высоты

Восклицательные знаки создаются автоматически на указанных локациях. Если нужно изменить позицию:

1. Найдите GameObject с локацией (например, Workbench)
2. Создайте дочерний GameObject для восклицательного знака
3. Расположите его на нужной высоте (например, Y = 2.0 над верстаком)
4. Перетащите этот дочерний GameObject в соответствующее поле локации в TutorialManager

### 6.2 Настройка для разных локаций

Для каждой локации можно создать отдельный Transform:
- `WorkbenchExclamationPoint` - для верстака
- `ShopComputerExclamationPoint` - для компьютера
- `PartSpawnExclamationPoint` - для точки спавна
- И т.д.

---

## Шаг 7: Настройка анимаций

### 7.1 Настройка анимации восклицательного знака

В компоненте `TutorialExclamationMark`:
- **Animation Distance**: Расстояние движения (рекомендуется 0.2-0.5)
- **Animation Duration**: Длительность цикла (рекомендуется 0.8-1.5 секунды)
- **Animation Ease**: Тип анимации (InOutSine для плавности)

### 7.2 Настройка анимаций UI

В компоненте `TutorialQuestUI`:
- **Complete Animation Duration**: Длительность анимации завершения (рекомендуется 0.4-0.6)
- **Switch Animation Duration**: Длительность смены текста (рекомендуется 0.2-0.4)
- **Bubble Scale**: Масштаб "бабблинга" (рекомендуется 1.1-1.3)

---

## Шаг 8: Отладка

### 8.1 Проверка логов

В консоли Unity должны появляться логи:
- `"TutorialManager: Initializing tutorial system..."`
- `"TutorialManager: Started quest X"`
- `"TutorialManager: Completed quest X"`
- `"TutorialManager: Tutorial completed!"`

### 8.2 Частые проблемы

**Проблема**: Туториал не запускается
- **Решение**: Проверьте, что TutorialManager находится в сцене и все обязательные поля заполнены

**Проблема**: Восклицательные знаки не появляются
- **Решение**: Проверьте, что префаб назначен и локации указаны (или система может их найти автоматически)

**Проблема**: Квесты не завершаются
- **Решение**: Проверьте логи в консоли, убедитесь, что события правильно подписаны

**Проблема**: Аудио не проигрывается
- **Решение**: Проверьте, что все 24 аудио клипа назначены в правильном порядке

**Проблема**: Прогресс не сохраняется
- **Решение**: Проверьте, что YG2 SDK инициализирован и SaveSystemManager работает

---

## Шаг 9: Оптимизация

### 9.1 Производительность

- Восклицательные знаки используют DOTween для анимаций (эффективно)
- Polling для квестов выполняется только для активных квестов
- UI анимации проверяют полноэкранные окна перед запуском

### 9.2 Рекомендации

- Используйте пул объектов для восклицательных знаков, если их много
- Оптимизируйте аудио файлы (сжатие, формат)
- Используйте LOD для 3D моделей восклицательных знаков

---

## Список квестов

1. **CreateGun** - Создать новое оружие на верстаке
2. **BuyBarrel** - Купить ствол в компьютере
3. **TakeBarrel** - Взять ствол
4. **AttachBarrel** - Прикрепить ствол к оружию
5. **TakeBlowtorch** - Взять горелку
6. **WeldBarrel** - Приварить ствол горелкой
7. **BuyMag** - Купить магазин в компьютере
8. **TakeMag** - Взять магазин
9. **AttachMag** - Прикрепить магазин к оружию
10. **TakeGun** - Взять оружие с верстака
11. **ShootTargets** - Стрелять по мишеням
12. **EnterRange** - Подойти к двери и войти на стрельбище

---

## Дополнительные настройки

### Автоматический поиск локаций

Если локации не назначены вручную, система автоматически найдет:
- Workbench через `FindFirstObjectByType<Workbench>()`
- ShopComputer через `FindFirstObjectByType<ShopComputer>()`
- PartSpawner через `PartSpawner.Instance.SpawnPoint`
- Blowtorch через `FindFirstObjectByType<Blowtorch>()`
- LocationDoor через `FindFirstObjectByType<LocationDoor>()`

**Примечание**: ShootingTargetsLocation нужно назначить вручную, так как это кастомная локация.

---

## Заключение

После выполнения всех шагов система туториала должна быть полностью настроена и готова к использованию. При возникновении проблем проверьте логи в консоли Unity и убедитесь, что все компоненты правильно настроены.

